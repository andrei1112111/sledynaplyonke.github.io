<base href="https://s3-us-west-2.amazonaws.com/s.cdpn.io/4273/">
<header>
	<h1>Банька<span>по-черному</span></h1>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Банька по-черному</title>

    <script>

        // ====== Универсальная функция для локальных видео ======
function playVideo(video) {
    const src = video.dataset.src || video.src;
    if (!src) return;
    if (!video.src) video.src = src;

    // обязательно задать mute + inline
    video.muted = true;
    video.playsInline = true;

    video.play().catch(err => {
        console.warn("Autoplay blocked, waiting for user gesture:", err);
    });
}

// ====== Инициализация после загрузки страницы ======
document.addEventListener("DOMContentLoaded", () => {
    const videos = document.querySelectorAll("video.header-video");
    let loadedVideos = 0;
    let vfxInitialized = false;

    // === Подсказка ===
    const hint = document.createElement("div");
    hint.textContent = "Нажмите на экран, если видео не начали проигрываться)";
    Object.assign(hint.style, {
        position: "fixed",
        top: "20px",
        right: "-800px",
        background: "rgba(0, 0, 0, 0.7)",
        color: "#fff",
        padding: "12px 18px",
        borderRadius: "8px",
        fontSize: "15px",
        fontFamily: "sans-serif",
        zIndex: 9999,
        boxShadow: "0 0 10px rgba(0,0,0,0.4)",
        transition: "right 0.8s ease, opacity 0.8s ease",
        opacity: "0.9"
    });
    document.body.appendChild(hint);

    setTimeout(() => {
        hint.style.right = "20px";
    }, 10000);

    const hideHint = () => {
        hint.style.opacity = "0";
        hint.style.right = "-400px";
        setTimeout(() => hint.remove(), 800);
        document.removeEventListener("click", hideHint);
        // запустить все видео при первом клике (если autoplay был заблокирован)
        videos.forEach(v => v.play().catch(()=>{}));
    };
    document.addEventListener("click", hideHint);

    // === Функция инициализации VFX ===
    function tryInitVFX() {
        if (vfxInitialized) return;
        if (videos.length === 0 || loadedVideos === videos.length) {
            setTimeout(() => {
                initVFX();
                vfxInitialized = true;
            }, 300);
        }
    }

    // === Запуск загрузки и управление воспроизведением ===
    if (videos.length === 0) {
        tryInitVFX();
    } else {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const video = entry.target;
                if (!video.src && video.dataset.src) {
                    video.src = video.dataset.src; // ленивое подключение
                }

                if (entry.isIntersecting) {
                    // когда видео в зоне видимости — запустить
                    video.play().catch(() => {});
                } else {
                    // если ушло за экран — поставить на паузу
                    video.pause();
                }
            });
        }, {
            threshold: 0.05 // видео считается "на экране", если видно хотя бы 5%
        });

        videos.forEach(video => {
            // Подключаем observer
            observer.observe(video);

            // Начальная инициализация
            playVideo(video);

            // Обработка загрузки
            video.addEventListener("loadeddata", () => {
                loadedVideos++;
                tryInitVFX();
            });

            // Ошибка загрузки
            video.addEventListener("error", () => {
                console.error("Video failed to load:", video.dataset.src || video.src);
                loadedVideos++;
                tryInitVFX();
            });
        });
    }
});

// ====== Инициализация VFX ======
function initVFX() {
    const vfx = new VFX({
        scrollPadding: false,
        postEffect: { shader },
        autoResize: true,
        cover: true,
        mipmap: false, // отключаем генерацию mipmap
    });

    let i = 0;
    for (const el of document.querySelectorAll("img, video, h1, h2, p")) {
        const z = el.getAttribute("data-z");
        const isVideo = el.tagName === "VIDEO";

        vfx.add(el, {
            shader: shader2,
            uniforms: { id: i++ },
            zIndex: z ? parseInt(z) : 0,
            replace: !isVideo
        });
    }

    return vfx;
}

    </script>


    <style>
        video.header-video {
            display: block;
            width: 100%;
            height: auto;
            object-fit: cover;
            pointer-events: none;
            user-select: none;
            background: black;
        }

* {
  box-sizing: border-box;
}
img {
  max-width: 100%; /* Макс. ширина 100% от контейнера */
  height: auto
}

body {
  margin: 0;
  color: darkslategrey;
}
header { 
	background: url(https://cdn.jsdelivr.net/gh/andrei1112111/sledynaplyonke.github.io@main/data/tanvan/1.jpeg) no-repeat;
	padding-top: 61.93333333%;
	background-size: cover;
  font-family: 'Sucrose Bold Two';
}


header img {
	position: absolute;
	top: 0;
	right: 0;
	width: 45.8%;
}
header h1 { 
	position: fixed;
	top: 2rem;
	right: 2rem;
  font-size: 12vw;
  line-height: .8;
  margin-top: 0;
  text-align: center;
  color:beige;
}
header h1 span {
  display: block;
  font-size: 8.75vw;
}
p {
    font-family: 'Courier New', Courier, monospace;
    font:bold;
    color:beige;
    padding: 2rem 15%;
}
main { 
  background: darkslategrey;
  position: relative;
  border: 1px solid darkslategrey;
  font-family: 'IM Fell French Canon Pro';
  font-size: 1.4rem;
  /* padding: 2rem 25%; */
  line-height: 1.6;
}
@media all and (max-width: 400px) {
  main { padding: 2rem; }
}

    </style>
</header>
<main>
  <p>Посреди обского моря находится прикрасный остров Таньвань.<br><br>
    Вот только вспомнили мы про него уже в середине февраля... Было принято решение незамедлительно выдвигаться на остров пока лед на море еще прочный.</p>

  <video class="header-video" preload="none" loading="lazy" autoplay loop muted playsinline preload="auto" disablePictureInPicture controlslist="nodownload nofullscreen noremoteplayback noplaybackrate"
               data-src="https://cdn.jsdelivr.net/gh/andrei1112111/sledynaplyonke.github.io@main/data/tanvan/2.mp4"
               crossOrigin="anonymous"></video>

    <p>Собрав сумки мы выдвинулись пасмурным субботним днем. <br>Путь проходил через станцию обское море. По какой-то таинственной причине через эту станцию проходят все пути...</p>          
  <h1 style="background: url(https://cdn.jsdelivr.net/gh/andrei1112111/sledynaplyonke.github.io@main/data/tanvan/3.jpeg) no-repeat;
            padding-top: 61.93333333%;
            background-size: cover;
            font-family: 'Sucrose Bold Two';"></h1>

    <p>Зимой станция выглядит грустненько, но есть в этом какой-то думерский вайбик</p> 

    <h1 style="background: url(https://cdn.jsdelivr.net/gh/andrei1112111/sledynaplyonke.github.io@main/data/tanvan/4.jpeg) no-repeat;
            padding-top: 61.93333333%;
            background-size: cover;
            font-family: 'Sucrose Bold Two';"></h1>

    <p>Далее мы начали спуск к обскому морю - водохронилищу появившемуся после строительства Обь ГЭС. Водохранилеще похоронило старый город Бердск и часть Бердского тракта. Городу пришлось переехать на холм повыше а тракт перенесли на пару километров всторону.</p> 

    <h1 style="background: url(https://cdn.jsdelivr.net/gh/andrei1112111/sledynaplyonke.github.io@main/data/tanvan/5.jpeg) no-repeat;
            padding-top: 61.93333333%;
            background-size: cover;
            font-family: 'Sucrose Bold Two';"></h1>

    <p>В настроющий момент ни о тракте ни о старом городе уже ничего не напоминает. Осталось только пара-тройка островов посреди моря. Когда-то это были холмы в полях, сейчас - медленно уходящие под воду островки.</p> 

    <p>На сам остров мы посмотрим когда доберемся до него, а сейчас - лодочная станция на берегу обского моря.</p> 

    <h1 style="background: url(https://cdn.jsdelivr.net/gh/andrei1112111/sledynaplyonke.github.io@main/data/tanvan/6.jpeg) no-repeat;
                padding-top: 61.93333333%;
                background-size: cover;
                font-family: 'Sucrose Bold Two';"></h1>
    
    <h1 style="background: url(https://cdn.jsdelivr.net/gh/andrei1112111/sledynaplyonke.github.io@main/data/tanvan/7.jpeg) no-repeat;
                padding-top: 61.93333333%;
                background-size: cover;
                font-family: 'Sucrose Bold Two';"></h1>

    <p>Путь к острову проходит по дорожкам протоптанным рыбаками по которым они передвигаются между своими любимыми лунками и рыбными местами.</p>

    <video class="header-video" preload="none" loading="lazy" autoplay loop muted playsinline preload="auto" disablePictureInPicture controlslist="nodownload nofullscreen noremoteplayback noplaybackrate"
               data-src="https://cdn.jsdelivr.net/gh/andrei1112111/sledynaplyonke.github.io@main/data/tanvan/8.mp4"
               crossOrigin="anonymous"></video>

    <p>По пути нам встречались проталины, хотя на улице и было -10 но вода в них не замерзала...</p>

    <h1 style="background: url(https://cdn.jsdelivr.net/gh/andrei1112111/sledynaplyonke.github.io@main/data/tanvan/9.jpeg) no-repeat;
                padding-top: 61.93333333%;
                background-size: cover;
                font-family: 'Sucrose Bold Two';"></h1>

    <p>По пути к острову встречаются интересные природные явления. Некоторые рукотворные, некоторые чисто природные.</p>

    <h1 style="background: url(https://cdn.jsdelivr.net/gh/andrei1112111/sledynaplyonke.github.io@main/data/tanvan/10.jpeg) no-repeat;
                padding-top: 61.93333333%;
                background-size: cover;
                font-family: 'Sucrose Bold Two';"></h1>
    
    <h1 style="background: url(https://cdn.jsdelivr.net/gh/andrei1112111/sledynaplyonke.github.io@main/data/tanvan/11.jpeg) no-repeat;
                padding-top: 61.93333333%;
                background-size: cover;
                font-family: 'Sucrose Bold Two';"></h1>


    <p>Спустя полтора часа мы все-же добрались до острова. Первая локация которую мы исследовали - Банька.</p>

    <h1 style="background: url(https://cdn.jsdelivr.net/gh/andrei1112111/sledynaplyonke.github.io@main/data/tanvan/12.jpeg) no-repeat;
                padding-top: 61.93333333%;
                background-size: cover;
                font-family: 'Sucrose Bold Two';"></h1>

    <p>И пусть выглядит она не как лакшери виладж, после двух часов на ногах при холодной погоде начинаешь воспринимать такие места так-же тепло как родной дом.</p>

    <p>И пусть выглядит она не как лакшери виладж, после двух часов на ногах при холодной погоде начинаешь воспринимать такие места так-же тепло как родной дом.</p>

    <video class="header-video" preload="none" loading="lazy" autoplay loop muted playsinline preload="auto" disablePictureInPicture controlslist="nodownload nofullscreen noremoteplayback noplaybackrate"
               data-src="https://cdn.jsdelivr.net/gh/andrei1112111/sledynaplyonke.github.io@main/data/tanvan/13.mp4"
               crossOrigin="anonymous"></video>

    <p>В таких местах встречаются тетради с корандашами. Этакиt дневники возведенной кем-то постройки. На страницах очерки десятков путников посетивших место.</p>
    <p>Видео ниже должно быть со звком. Возможно на него понадобиться тыкнуть.</p>
    
    <video class="header-video" preload="none" loading="lazy" loop preload="auto"
               data-src="https://cdn.jsdelivr.net/gh/andrei1112111/sledynaplyonke.github.io@main/data/tanvan/14.mp4"
               crossOrigin="anonymous"></video>

    <p>Для разведения огня нам предстояло добыть дерева и найти сухих веток для росжига.</p>

    <h1 style="background: url(https://cdn.jsdelivr.net/gh/andrei1112111/sledynaplyonke.github.io@main/data/tanvan/15.jpeg) no-repeat;
                padding-top: 61.93333333%;
                background-size: cover;
                font-family: 'Sucrose Bold Two';"></h1>


            </main>
<body>
</body>